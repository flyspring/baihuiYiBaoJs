window.BaiHuiYiBao=function(t){var e={};function s(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,o){s.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:o})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=1)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e,s){void 0===e&&(e="8000"),void 0===s&&(s=!1),this.ip="",this.port="",this.url="",this.reqStatus=!1,this.connected=!1,this.ip=""==t?"localhost":t,this.port=""==e?"8000":e,this.debug=s,this.connected=!1,this.reqStatus=!1,this.websocket=!1,this.handler=!1}return t.prototype.connect=function(){return!!this.isConnected()||(this.websocket&&(this.websocket=!1),this.websocket||(this.websocket=new WebSocket(this.getUrl()),this.websocket.onopen=function(t){this.debug&&console.log("onpen",t),this.handler&&this.handler({msg:"HS_CONNECTED",data:{}})},this.websocket.onerror=function(t){this.debug&&console.log("onerror",t),this.handler&&this.handler({msg:"HS_ERROR",data:t.data})},this.websocket.onmessage=function(t){this.debug&&console.log("onmessage",t),this.setReqStatus(!1);var e=t.data.indexOf(">"),s=t.data.substring(0,e),o=t.data.substring(e+1,t.data.length),n="T:"==o.substring(0,2);o=o.substring(2,o.length),this.handler&&this.handler({msg:s,rst:n,data:o})},this.websocket.onclose=function(t){this.debug&&console.log("onclose",t),this.connected=!1,this.handler&&this.handler({msg:"HS_DISCONNECTED",data:{}})}),this.setConnected(!0),this.setReqStatus(!1),!0)},t.prototype.sendMsg=function(t,e,s){return this.isConnected()?this.getReqStatus()?{code:3,msg:"有请求未处理完，请稍后重试"}:(this.setReqStatus(!0),this.websocket.send(t+":"+e+">"+s),{code:1,msg:"发送成功"}):{code:2,msg:"HIS链接中断需要重新连接"}},t.prototype.setHandler=function(t){this.handler=t},t.prototype.getReqStatus=function(){return this.reqStatus},t.prototype.setReqStatus=function(t){this.reqStatus=t},t.prototype.isConnected=function(){return this.websocket&&this.connected},t.prototype.setConnected=function(t){this.connected=t},t.prototype.getUrl=function(){return""==this.url&&(this.url="ws://"+this.ip+":"+this.port+"/"),this.url},t}();e.Connection=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=s(0),n=function(){function t(t,e){this.ybType=t,this.setOptions(e),this.callbacks={HS_CONNECTED:this.init,RST_INIT:this.login,RST_LOGIN:this.ready,RST_READ_CARD:!1,RST_REGISTRATION:!1,RST_CALC_REG:!1,RST_CALC_PST:!1,RST_PAY_REG:!1,RST_PAY_PST:!1,HS_DISCONNECTED:this.close,HS_ERROR:this.error},this.connection=new o.Connection(this.options.ip,this.options.port,this.options.debug),this.connection.setHandler(this.handleEvent),this.connection.connect()}return t.prototype.setOptions=function(t){this.options={ip:t.ip||"localhost",port:t.port||"8000",debug:t.debug||!1,userName:t.userName||"",userId:t.userId||"",yibao:t.yibao||{}}},t.prototype.init=function(t,e){if(!this.options.yibao.医院编码)return this.options.debug&&console.log("初始化医保参数有误"),!1;this.sendMsg("REQ_INIT",this.options.yibao)},t.prototype.login=function(t,e){if(!this.options.userName||!this.options.userId)return alert("医保登录失败，缺少操作名或者操作人编号"),!1;var s={"操作员编号":this.options.userId,"操作员姓名":this.options.userName};this.sendMsg("REQ_LOGIN",s)},t.prototype.ready=function(t,e){console.log(t+": 登录签到成功，业务周期编号："+e)},t.prototype.close=function(t,e){console.log(t+": 链接断开")},t.prototype.error=function(t,e){alert(t+": 链接医保助手出现异常，请确保医保助手已经启动")},t.prototype.readCard=function(t,e){this.sendMsg("REQ_READ_CARD","")},t.prototype.handleEvent=function(t){if(this.options.debug&&console.log("handleEvent",t),!t||!t.msg)return!1;var e=this.getHandler(t.msg);e&&e(this.ybType,t.data)},t.prototype.getHandler=function(t){return!(!this.callbacks||!this.callbacks.msg)&&this.callbacks.msg},t.prototype.setHandler=function(t,e){if(!e)return!1;0==this.callbacks&&(this.callbacks={}),this.callbacks.msg=e},t.prototype.sendMsg=function(t,e){var s=this.connection.sendMsg(this.ybType,t,e);return 1==s.code||(alert(s.msg),!1)},t}();e.BaiHuiYiBaoJs=n}]);