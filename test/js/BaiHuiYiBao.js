window.BaiHuiYiBao=function(t){var e={};function o(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.l=!0,s.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},o.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=1)}([function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(t,e,o){void 0===e&&(e="8000"),void 0===o&&(o=!1),this.ip="",this.port="",this.url="",this.reqStatus=!1,this.connected=!1,this.ip=""==t?"localhost":t,this.port=""==e?"8000":e,this.debug=o,this.connected=!1,this.reqStatus=!1,this.websocket=!1,this.handler=!1}return t.prototype.connect=function(){var t=this;return!!this.isConnected()||(this.websocket&&(this.websocket=!1),this.websocket||(this.websocket=new WebSocket(this.getUrl()),this.websocket.onopen=function(e){t.debug&&console.log("onopen",e),t.handler&&t.handler({cmd:"HS_CONNECTED",rst:!0,data:{}})},this.websocket.onerror=function(e){t.debug&&console.log("onerror",e),t.handler&&t.handler({cmd:"HS_ERROR",rst:!0,data:{}})},this.websocket.onmessage=function(e){t.debug&&console.log("onmessage",e),t.setReqStatus(!1);var o=e.data.indexOf(">"),n=e.data.substring(0,o),s=e.data.substring(o+1,e.data.length),i="T:"==s.substring(0,2);s=s.substring(2,s.length),t.handler&&t.handler({cmd:n,rst:i,data:s})},this.websocket.onclose=function(e){t.debug&&console.log("onclose",e),t.connected=!1,t.handler&&t.handler({cmd:"HS_DISCONNECTED",rst:!0,data:{}})}),this.setConnected(!0),this.setReqStatus(!1),!0)},t.prototype.sendMsg=function(t,e,o){return this.isConnected()?this.getReqStatus()?{code:3,msg:"有请求未处理完，请稍后重试"}:(this.setReqStatus(!0),this.websocket.send(t+":"+e+">"+o),{code:1,msg:"发送成功"}):{code:2,msg:"HIS链接中断需要重新连接"}},t.prototype.setHandler=function(t){this.handler=t},t.prototype.getReqStatus=function(){return this.reqStatus},t.prototype.setReqStatus=function(t){this.reqStatus=t},t.prototype.isConnected=function(){return this.websocket&&this.connected},t.prototype.setConnected=function(t){this.connected=t},t.prototype.getUrl=function(){return""==this.url&&(this.url="ws://"+this.ip+":"+this.port+"/"),this.url},t}();e.Connection=n},function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(0),s=function(){function t(t,e){var o=this;this.ybType=t,this.setOptions(e),this.defaultCallbacks={HS_CONNECTED:this.init,RST_INIT:this.login,RST_LOGIN:this.ready,HS_DISCONNECTED:this.close,HS_ERROR:this.error},this.callbacks={RST_READ_CARD:!1,RST_REGISTRATION:!1,RST_CALC_REG:!1,RST_CALC_PST:!1,RST_PAY_REG:!1,RST_PAY_PST:!1},this.connection=new n.Connection(this.options.ip,this.options.port,this.options.debug),this.connection.setHandler(function(t){if(!t||!t.cmd)return!1;var e=o.getDefaultCallback(t.cmd);if(e)e.call(o,t.rst,t.data);else if(e=o.getCallback(t.cmd)){var n=t.rst?JSON.parse(t.data):t.data;e(o.ybType,t.rst,n)}}),this.connection.connect()}return t.prototype.setOptions=function(t){this.options={ip:t.ip||"localhost",port:t.port||"8000",debug:t.debug||!1,userName:t.userName||"",userId:t.userId||"",yibao:t.yibao||{}}},t.prototype.init=function(t,e){return t?this.options.yibao.医院编码?void this.sendMsg("REQ_INIT",this.options.yibao):(this.options.debug&&console.log("初始化医保参数有误"),!1):(console.log("链接失败，无法进行初始化操作"),!1)},t.prototype.login=function(t,e){if(!t)return console.log("init初始化失败，无法进行后续登录签到操作"),!1;if(!this.options.userName||!this.options.userId)return alert("医保登录失败，缺少操作名或者操作人编号"),!1;var o={"操作员编号":this.options.userId,"操作员姓名":this.options.userName};this.sendMsg("REQ_LOGIN",o)},t.prototype.ready=function(t,e){if(!t)return console.log(this.ybType+": 登录签到失败"),!1;console.log(this.ybType+": 登录签到成功，业务周期编号："+e)},t.prototype.close=function(t,e){console.log(this.ybType+": 链接断开")},t.prototype.error=function(t,e){alert(t+": 链接医保助手出现异常，请确保医保助手已经启动")},t.prototype.readCard=function(t){this.options.debug&&console.log("正在请求读卡",t),this.sendMsg("REQ_READ_CARD","")},t.prototype.register=function(t){this.options.debug&&console.log("正在请求登记",t),this.sendMsg("REQ_REGISTRATION",t)},t.prototype.tryCalc=function(t,e){"PST"==(t=t.toUpperCase())||"REG"==t?(this.options.debug&&console.log("正在试算",e),this.sendMsg("REQ_CALC_"+t,e)):console.log("试算参数有误")},t.prototype.payCalc=function(t,e){"PST"==(t=t.toUpperCase())||"REG"==t?(this.options.debug&&console.log("正在结算",e),this.sendMsg("REQ_PAY_"+t,e)):console.log("结算参数有误")},t.prototype.setCallbacks=function(t){var e=this;t.forEach(function(t){t.cmd&&t.callback&&e.setCallback(t.cmd,t.callback)})},t.prototype.setCallback=function(t,e){t="RST_"+t.toUpperCase(),this.callbacks[t]=e},t.prototype.getDefaultCallback=function(t){return this.getHandler(this.defaultCallbacks,t)},t.prototype.getCallback=function(t){return this.getHandler(this.callbacks,t)},t.prototype.getHandler=function(t,e){return!(!t||!t[e])&&t[e]},t.prototype.sendMsg=function(t,e){e&&(e=JSON.stringify(e));var o=this.connection.sendMsg(this.ybType,t,e);return 1==o.code||(alert(o.msg),!1)},t}();e.BaiHuiYiBaoJs=s}]);